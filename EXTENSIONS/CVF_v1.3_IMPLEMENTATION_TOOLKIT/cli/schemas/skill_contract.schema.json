{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "CVF Skill Contract Schema",
    "description": "JSON Schema for validating CVF Skill Contracts (v1.2/v1.3)",
    "type": "object",
    "required": [
        "capability_id",
        "domain",
        "description",
        "risk_level",
        "governance",
        "input_spec",
        "output_spec",
        "execution",
        "audit"
    ],
    "properties": {
        "capability_id": {
            "type": "string",
            "pattern": "^[A-Za-z][A-Za-z0-9_-]*$",
            "description": "Unique identifier for the capability"
        },
        "domain": {
            "type": "string",
            "description": "Domain category (e.g., devops, data, security, product)"
        },
        "description": {
            "type": "string",
            "minLength": 10,
            "description": "Clear description of what the capability does"
        },
        "risk_level": {
            "type": "string",
            "enum": [
                "R0",
                "R1",
                "R2",
                "R3"
            ],
            "description": "Risk level: R0 (Passive), R1 (Controlled), R2 (Elevated), R3 (Critical)"
        },
        "version": {
            "type": "string",
            "pattern": "^[0-9]+\\.[0-9]+$",
            "default": "1.0"
        },
        "governance": {
            "type": "object",
            "properties": {
                "allowed_archetypes": {
                    "type": "array",
                    "items": {
                        "type": "string",
                        "enum": [
                            "Analysis",
                            "Decision",
                            "Planning",
                            "Execution",
                            "Supervisor",
                            "Exploration"
                        ]
                    }
                },
                "allowed_phases": {
                    "type": "array",
                    "items": {
                        "type": "string",
                        "enum": [
                            "A",
                            "B",
                            "C",
                            "D"
                        ]
                    }
                },
                "required_decisions": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "required_status": {
                    "type": "string",
                    "enum": [
                        "PROPOSED",
                        "APPROVED",
                        "ACTIVE",
                        "DEPRECATED"
                    ],
                    "default": "ACTIVE"
                }
            }
        },
        "input_spec": {
            "type": "array",
            "minItems": 1,
            "items": {
                "type": "object",
                "required": [
                    "name",
                    "type"
                ],
                "properties": {
                    "name": {
                        "type": "string"
                    },
                    "type": {
                        "type": "string",
                        "enum": [
                            "string",
                            "integer",
                            "number",
                            "boolean",
                            "array",
                            "object"
                        ]
                    },
                    "required": {
                        "type": "boolean",
                        "default": true
                    },
                    "default": {},
                    "validation_rule": {
                        "type": "string"
                    }
                }
            }
        },
        "output_spec": {
            "type": "array",
            "minItems": 1,
            "items": {
                "type": "object",
                "required": [
                    "name",
                    "type"
                ],
                "properties": {
                    "name": {
                        "type": "string"
                    },
                    "type": {
                        "type": "string",
                        "enum": [
                            "string",
                            "integer",
                            "number",
                            "boolean",
                            "array",
                            "object"
                        ]
                    },
                    "success_criteria": {
                        "type": "string"
                    },
                    "failure_signals": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    },
                    "range": {
                        "type": "array",
                        "items": {
                            "type": "number"
                        },
                        "minItems": 2,
                        "maxItems": 2
                    }
                }
            }
        },
        "execution": {
            "type": "object",
            "properties": {
                "side_effects": {
                    "type": "boolean",
                    "default": false
                },
                "rollback_possible": {
                    "type": "boolean",
                    "default": true
                },
                "idempotent": {
                    "type": "boolean",
                    "default": true
                },
                "expected_duration": {
                    "type": "string"
                },
                "execution_type": {
                    "type": "string",
                    "enum": [
                        "EXECUTABLE",
                        "NON_EXECUTABLE"
                    ],
                    "default": "EXECUTABLE"
                }
            }
        },
        "audit": {
            "type": "object",
            "properties": {
                "trace_level": {
                    "type": "string",
                    "enum": [
                        "Basic",
                        "Full"
                    ],
                    "default": "Full"
                },
                "required_fields": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "default": [
                        "timestamp",
                        "actor",
                        "inputs",
                        "outputs"
                    ]
                }
            }
        },
        "failure_info": {
            "type": "object",
            "properties": {
                "known_failure_modes": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "worst_case_impact": {
                    "type": "string"
                },
                "human_intervention_required": {
                    "type": "boolean",
                    "default": false
                }
            }
        },
        "dependencies": {
            "type": "array",
            "items": {
                "type": "string"
            }
        }
    }
}