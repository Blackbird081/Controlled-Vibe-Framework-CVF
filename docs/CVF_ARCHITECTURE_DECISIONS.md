# CVF Architecture Decisions

> **Location:** `docs/CVF_ARCHITECTURE_DECISIONS.md`
> **Format:** See `governance/toolkit/05_OPERATION/CVF_ADR_GUARD.md`
> **Rule:** Every entry must correspond to a commit using a trigger pattern (`feat(governance):`, `feat(domain):`, etc.)

---

## ADR-001: Domain Strategy — Job Function over User Type

| Field | Value |
|---|---|
| Date | 2026-02-27 |
| Status | Active |
| Related commits | `c91a8ff`, `964bc08` |

### Context
During skills intake from the CVF-Compatible Skills source archive, 7 new skills were initially placed under a domain called `non_coder_workflow`. This domain was named after a *user type* (non-coders), not a *job function*. This created a structural inconsistency with all existing CVF domains which are named after functional areas (`app_development`, `product_ux`, `finance_analytics`...).

### Decision
**Domains MUST be named after job functions, never user types or personas.**

The `non_coder_workflow` domain was dissolved. Its 7 skills were migrated:
- 6 skills → `app_development`
- 1 skill → `product_ux`

### Rationale
- User types are volatile (a "non-coder" today may learn to code tomorrow)
- Job functions are stable and map to real-world workflows
- All existing CVF domains follow the job-function pattern — consistency is critical for AI skill routing
- A `non_coder_workflow` domain would create a second classification axis, complicating the skill index

### Consequences
- All existing and future domains must pass the test: *"Is this a job function?"*
- The `SKILL_INTAKE_GOVERNANCE.md` disqualification rules explicitly ban user-type domain names
- `build-skill-index.js` domain maps were updated to remove `non_coder_workflow`

### Related Files
- `governance/toolkit/05_OPERATION/SKILL_INTAKE_GOVERNANCE.md`
- `EXTENSIONS/CVF_v1.6_AGENT_PLATFORM/cvf-web/scripts/build-skill-index.js`
- `EXTENSIONS/CVF_v1.5.2_SKILL_LIBRARY_FOR_END_USERS/app_development/` (migrated skills)

---

## ADR-002: Skill Content Language — English Only

| Field | Value |
|---|---|
| Date | 2026-02-27 |
| Status | Active |
| Related commits | `36195bd` |

### Context
8 new skills were imported from the CVF-Compatible Skills archive. All were written in Vietnamese. The existing 141 skills in the CVF library are written in English. Skills function as governance instructions for AI/Agent execution — they define constraints, validation hooks, and behavioral rules that the AI reads and follows.

### Decision
**All skill file content MUST be written in English.**

All 8 imported skills were fully translated to English (v1.1.0). This applies to all future skill additions.

### Rationale
- AI/Agent models process English governance instructions more consistently across different AI providers
- Vietnamese-only skills create a split codebase that is difficult to maintain
- The CVF skill library is designed to be shareable and AI-agnostic — English maximizes compatibility
- Vietnamese may still appear in *user-facing output* (e.g. `USER_GUIDE.md` generated by Auto Documentation skill), but the skill governance layer itself must be English

### Consequences
- `SKILL_INTAKE_GOVERNANCE.md` mandates English as a disqualification rule
- Existing 141 skills: already in English — no action needed
- New or imported skills: must be translated BEFORE being placed in the library
- The filename `05_auto_documentation_vn.skill.md` retains `_vn` in the name to indicate the skill *generates* Vietnamese output, not that the skill itself is in Vietnamese

### Related Files
- `governance/toolkit/05_OPERATION/SKILL_INTAKE_GOVERNANCE.md` (Language Rule section)
- `EXTENSIONS/CVF_v1.5.2_SKILL_LIBRARY_FOR_END_USERS/app_development/01_vibe_to_spec.skill.md` (and 7 others)

---

## ADR-003: Skill Intake Governance — Formal Policy Required

| Field | Value |
|---|---|
| Date | 2026-02-27 |
| Status | Active |
| Related commits | `36195bd` |

### Context
During the CVF-Compatible Skills intake, multiple structural errors occurred that had to be corrected retroactively:
1. Skills were placed in a wrong domain (`non_coder_workflow` instead of `app_development`)
2. Skills were written in Vietnamese instead of English
3. Skills had no corresponding Template entries in the Web UI
4. UAT binding paths referenced the old wrong domain

These errors were only caught during manual review, not by any automated gate. Without a formal intake process, every new skill addition risks repeating the same mistakes.

### Decision
**A formal Skill Intake Governance policy is mandatory for all new skills.**

Created `governance/toolkit/05_OPERATION/SKILL_INTAKE_GOVERNANCE.md` with:
- 5 intake criteria (all must pass before intake begins)
- Auto-reject disqualification rules
- Domain assignment rules with priority order
- Decision matrix (INTAKE / REJECT / HOLD)
- 15-section mandatory checklist
- Template Bridge Requirement (every skill must have a Web UI template)
- Full 7-step governance pipeline

### Rationale
- Without a formal process, intake quality depends entirely on the reviewer's memory
- The 5 intake criteria catch structural errors *before* files are created
- The disqualification rules explicitly prevent recurrence of the exact errors that occurred in this intake
- The Template Bridge Requirement ensures no skill is "invisible" to end-users via the Web UI

### Consequences
- Any future skill addition (internal or external) must follow this policy
- `CONTINUOUS_GOVERNANCE_LOOP.md` drift triggers must include "policy added without ADR"
- `CVF_ADR_GUARD.md` policies themselves must be recorded as ADRs (this entry demonstrates compliance)
- The CVF_SKILL_INTAKE_RECORD.md (bare-bones template) is superseded in practice by SKILL_INTAKE_GOVERNANCE.md for process; the record file remains for individual skill sign-offs

### Related Files
- `governance/toolkit/05_OPERATION/SKILL_INTAKE_GOVERNANCE.md`
- `governance/toolkit/05_OPERATION/CVF_SKILL_INTAKE_RECORD.md`
- `EXTENSIONS/CVF_v1.6_AGENT_PLATFORM/cvf-web/src/lib/skill-template-map.ts`
- `EXTENSIONS/CVF_v1.6_AGENT_PLATFORM/cvf-web/src/lib/templates/development.ts`
- `EXTENSIONS/CVF_v1.6_AGENT_PLATFORM/cvf-web/src/lib/templates/product.ts`

---

## ADR-004: ADR Guard — Architecture Decision Traceability Policy

| Field | Value |
|---|---|
| Date | 2026-02-27 |
| Status | Active |
| Related commits | *(this commit)* |

### Context
CVF already had Bug Guard and Test Guard for documenting fixes and test results. However, architectural and strategic decisions (core value corrections, domain strategy, governance policy additions) were only recorded in git commit messages — which capture *what* changed but not *why*. This created a traceability gap for future contributors and AI agents needing to understand design rationale.

### Decision
**Architectural and strategic decisions require ADR entries in `docs/CVF_ARCHITECTURE_DECISIONS.md`.**

Created `governance/toolkit/05_OPERATION/CVF_ADR_GUARD.md` defining:
- Trigger patterns: `feat(core-value):`, `feat(governance):`, `feat(domain):`, `refactor(arch):`, `docs(policy):`
- Mandatory ADR fields: Context, Decision, Rationale, Consequences, Related commits/files
- ADR lifecycle: Active / Superseded / Revoked (never delete)
- Integration with Continuous Governance Loop as a drift trigger

### Rationale
- Bug Guard = *what broke*; Test Guard = *what was tested*; ADR = *why the architecture is this way*
- These are orthogonal concerns requiring separate documentation
- Commit messages are discoverable only if you know to look — ADRs are a first-class searchable document
- CVF's governance loop explicitly requires "Decision Traceability" (Section 7 of CONTINUOUS_GOVERNANCE_LOOP.md) — ADR Guard operationalizes this requirement

### Consequences
- All future architecture/strategy decisions must trigger an ADR
- `CONTINUOUS_GOVERNANCE_LOOP.md` updated: ADR-less architecture decision = drift trigger
- Historical decisions (ADR-001, 002, 003) backfilled in this same commit
- The 4 guard types (Bug, Test, Skill Intake, ADR) together provide complete traceability coverage

### Related Files
- `governance/toolkit/05_OPERATION/CVF_ADR_GUARD.md`
- `governance/toolkit/05_OPERATION/CONTINUOUS_GOVERNANCE_LOOP.md`
- `docs/CVF_ARCHITECTURE_DECISIONS.md` (this file)
